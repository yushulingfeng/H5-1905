!function(){"use strict";var e={ONLINE:"//log-collector.kaola.com",IDC:"http://10.194.119.52:9000",JD:"http://10.177.15.170:9000",LOCAL:""},t={COLLECT:"/api/monitor/collect"};function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,n=e.data,i=e.success,r=void 0===i?function(){}:i,o=e.error,a=void 0===o?function(){}:o,s=function(){var e=void 0;if(window.XMLHttpRequest)(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml");else if(window.ActiveXObject)for(var t=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<t.length;n++)try{if(e=new ActiveXObject(t[n]))break}catch(e){}return e}();s&&(n="string"==typeof n?n:JSON.stringify(n),s.open("POST",t,!0),s.onreadystatechange=function(){4==s.readyState&&(200==s.status?r():a(s))},s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send(n))}var i=3e4;function r(e,t){var n=parseFloat(e)||0;return t>0?parseFloat(n.toFixed(t)):n}function o(e,t,n){var i=0===r(e)||0===r(t)?0:r(e)-r(t);return n>0?r(i,n):i}function a(e){return function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=r(e),a=!1;switch(i){case 0:a=o>t&&o<n;break;case 1:a=o>t&&o<=n;break;case 2:a=o>=t&&o<n;break;case 3:a=o>=t&&o<=n}return a}(e,0,i,2)}function s(e){return Object.prototype.toString.call(e).slice(8,-1)}function c(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];return t.map(function(e){if(i!==e){if("Object"!==s(e))throw Error("merge sources must be all Objects.");for(var t in e)i[t]=e[t]}}),i}var u=void 0,l=[],d=10;function f(){setInterval(function(){if(window.$KLMP=window.$KLMP||[],"Array"===s($KLMP)?$KLMP.map(function(e){e.category?l.push(e):console.error('$KLMP require a "category".')}):console.error("$KLMP must be an Array."),$KLMP=[],l.length>0){var e=l.slice(0,d);l=l.splice(d),v({data:e.map(function(e){var t=e||{},n=t.category,i=t.indexs,r=t.metrics,o=t.time,a=void 0===o?Date.now():o,s=t.info,l=void 0===s?{}:s,d=i=c({},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.url&&e._uniq_id?{url:e.url,_uniq_id:e._uniq_id}:e}(u),i),f=d._uuid,v=d._uniq_id,w=d.fullPath;return delete i._uniq_id,delete i._uuid,delete i.fullPath,{category:n,indexs:i,metrics:r,time:a,info:c({},l,{url:w,_uuid:f,_uniq_id:v})}})})}},2e3)}function v(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.ONLINE,o=t.COLLECT,a=i.data,s=i.error;n({url:""+r+o,data:a,error:void 0===s?function(e){console.error("monitor report error! status:"+e.status+", statusText:"+e.statusText)}:s})}var w={$push:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("Object"!==s(e))throw Error("data must be an Object.");return e.time||(e.time=Date.now()),l.push(e),e},$report:function(e){var t=e||{},n=t.category,i=t.indexs,r=t.metrics,o=t.time,a=void 0===o?Date.now():o,s=t.info,u=void 0===s?{}:s,l=i._uuid,d=i._uniq_id,f=i.fullPath;delete i._uniq_id,delete i._uuid,delete i.fullPath,v({data:[{category:n,indexs:i,metrics:r,time:a,info:c({},u,{url:f,_uuid:l,_uniq_id:d})}]})},$setIndexs:function(e){if("Object"!==s(e))throw Error("data must be an Object.");"Object"===s(u)?c(u,e):(u=e,f())}};function h(e,t,n,i,r,o){var a={ua:navigator.userAgent},s=[e];n&&void 0!==n&&s.push("line: "+n),i&&void 0!==i&&s.push("column: "+i),a.message=JSON.stringify(s.join(";")),r&&void 0!==r.stack&&(a.stack=function(e){if("string"!=typeof e)return e;return e.replace(/[\r|\n]/gi,"||")}(r.stack)),w.$push({category:o||"kl_front_err",indexs:{name:t,_log_type:"error"},metrics:{count:1},info:a,time:Date.now()})}window.addEventListener("error",function(e){var t=e.message,n=e.filename,i=e.lineno,r=e.colno,o=e.error;try{if(window.$KL_ERROR_MSG_FILTER&&window.$KL_ERROR_MSG_FILTER.length&&t){for(var a=!1,s=0;s<window.$KL_ERROR_MSG_FILTER.length;s++){var c=window.$KL_ERROR_MSG_FILTER[s];t.indexOf(c)>=0&&(a=!0)}if(a)return}}catch(e){console.info("错误信息过滤出错",e)}if(t)h(t,n,i,r,o);else switch(e.target.nodeName){case"LINK":h(e.target.href,null,null,null,null,"kl_front_res_err");break;case"IMG":case"SCRIPT":case"VIDEO":h(e.target.src,null,null,null,null,"kl_front_res_err");break;default:h("Unknown resource loading error.")}return!0},!0),window.addEventListener("unhandledrejection",function(e){return h(e.reason,"unhandledrejection"),!0});var p={0:"TYPE_NAVIGATE",1:"TYPE_RELOAD",2:"TYPE_BACK_FORWARD",255:"TYPE_UNDEFINED"},m={Kaola:[/kaolaApp\/|kaolaAppSpring\//,"/"],Yiupin:[/iOS_distApp\/|Android_distApp\//,"/"],Iqiyi:[/IqiyiVersion\//,"/"],Tiktok:[/aweme_/,"_"],Weibo:[/weibo__/,"__"],Wechat:[/MicroMessenger\//,"/"]},g=window.navigator.userAgent,b="unknow",y=window.statusbar||{},_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},k=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),T={PENDING:0,FULFILLED:1,REJECTED:2},S=function(){function e(t){var n=this;E(this,e),this.status=T.PENDING,this.resolveData=null,this.rejectData=null,this.onFulfilledList=[],this.onRejectedList=[],this.onResolve=function(e){n.status===T.PENDING&&(n.status=T.FULFILLED,n.resolveData=e,n.onFulfilledList.forEach(function(e){e(n.resolveData)}))},this.onReject=function(e){n.status===T.PENDING&&(n.status=T.REJECTED,n.rejectData=e,n.onRejectedList.forEach(function(e){e(n.rejectData)}))},this.resolvePromise=function(t,i,r){if(t instanceof e)t.status===T.PENDING?t.then(function(e){n.resolvePromise(e,i,r)},r):t.status===T.FULFILLED?i(t.resolveData):r(t.rejectData);else if(null!==t&&t instanceof Object)try{var o=t.then;o instanceof Function?o.call(t,function(e){n.resolvePromise(e,i,r)},r):i(t)}catch(e){r(e)}else i(t)};try{t(this.onResolve.bind(this),this.onReject.bind(this))}catch(e){this.onReject(e)}}return k(e,[{key:"then",value:function(t,n){var i=this;return this.status===T.PENDING?new e(function(e,r){i.onFulfilledList.push(function(){if(t instanceof Function){var n=t(i.resolveData);i.resolvePromise(n,e,r)}else e(i.resolveData)}),i.onRejectedList.push(function(){if(n instanceof Function){var t=n(i.rejectData);i.resolvePromise(t,e,r)}else r(i.rejectData)})}):this.status===T.FULFILLED?new e(function(e,n){if(t instanceof Function){var r=t(i.resolveData);i.resolvePromise(r,e,n)}else e(i.resolveData)}):new e(function(e,t){if(n instanceof Function){var r=n(i.rejectData);i.resolvePromise(r,e,t)}else t(i.rejectData)})}},{key:"catch",value:function(e){var t=this;e instanceof Function&&(this.status===T.PENDING?this.onRejectedList.push(function(){null!==t.rejectData&&e(t.rejectData)}):(this.status=T.REJECTED)&&null!==this.rejectData&&e(this.rejectData))}}],[{key:"resolve",value:function(t){return t instanceof e?t:new e(function(e,n){e(t)})}},{key:"reject",value:function(t){return t instanceof e?t:new e(function(e,n){n(t)})}},{key:"all",value:function(t){if(!(t instanceof Array))throw new TypeError("parameter must be array");var n=[],i=0;return new e(function(r,o){0===t.length?r(n):t.forEach(function(a,s){a instanceof e?a.then(function(e){n[s]=e,++i===t.length&&r(n)},function(e){o(e)}):(n[s]=a,++i===t.length&&r(n))})})}},{key:"race",value:function(t){if(!(t instanceof Array))throw new TypeError("parameter must be array");var n=!1;return new e(function(i,r){t.forEach(function(t){t instanceof e?t.then(function(e){n||(n=!0,i(e))},function(e){n||(n=!0,r(e))}):n||(n=!0,i(t))})})}}]),e}();function L(){var e=g.match(/NetType\/\w+/)?g.match(/NetType\/\w+/)[0]:"NetType/other",t=void 0;switch(e=e.toLowerCase().replace("nettype/","")){case"wifi":t="wifi";break;case"4g":t="4g";break;case"3g":case"3gnet":t="3g";break;case"2g":t="2g";break;default:t="other"}return t}function D(){for(var e in m)if(m.hasOwnProperty(e)&&m[e][0].test(g))return e;return b}function R(e){if(e===b)return b;var t=m[e][0].source,n=m[e][1],i=new RegExp("("+t+")[\\d\\.]+").exec(g);return i&&i.length&&i[0].split(n)[1]||b}function P(){return D()!==b}function C(){return/(iPhone|iPod|iPad)/i.test(g)}function M(){return C()?y.visible?"WKWebView":"UIWebView":/Android/i.test(g)?"AndroidWebView":b}function N(){return window.WeixinJSBridge}var O,x=function(){function e(){E(this,e);function t(){N()}N()&&N().on?t():document.addEventListener("WeixinJSBridgeReady",t),C()&&window.jsonRPC&&window.jsonRPC.ready&&window.jsonRPC.ready(!1)}return k(e,[{key:"_invoke",value:function(e,t){return new S(function(n,i){NJ.invoke(e,t,function(e){return n(e)},function(e){return i(e)})})}},{key:"invoke",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2],r=i&&i.timeout||500;return S.race([(t=r,new S(function(e){setTimeout(e,t,-1)})),this._invoke(e,n)])}}]),e}(),A=null,I={};function j(){var e=(+new Date).toString(16);function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t().substring(0,1)+e}I.init=function(){return P()&&!A&&(A=new x),I},I.invoke=(O="invoke",function(){var e;return P()?(A||I.init(),(e=A)[O].apply(e,arguments)):S.resolve(-1)});var F="model",q="name",$="type",G="vendor",K="version",B="mobile",V=function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n},U=function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},W=function(e){return"string"===(void 0===e?"undefined":_(e))?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},X={rgx:function(e,t){for(var n,i,r,o,a,s,c=0;c<t.length&&!a;){var u=t[c],l=t[c+1];for(n=i=0;n<u.length&&!a;)if(a=u[n++].exec(e))for(r=0;r<l.length;r++)s=a[++i],"object"===(void 0===(o=l[r])?"undefined":_(o))&&o.length>0?2==o.length?"function"==_(o[1])?this[o[0]]=o[1].call(this,s):this[o[0]]=o[1]:3==o.length?"function"!==_(o[1])||o[1].exec&&o[1].test?this[o[0]]=s?s.replace(o[1],o[2]):void 0:this[o[0]]=s?o[1].call(this,s,o[2]):void 0:4==o.length&&(this[o[0]]=s?o[3].call(this,s.replace(o[1],o[2])):void 0):this[o]=s||void 0;c+=2}},str:function(e,t){for(var n in t)if("object"===_(t[n])&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(U(t[n][i],e))return"?"===n?void 0:n}else if(U(t[n],e))return"?"===n?void 0:n;return e}},z={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},H={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[q,K],[/(opios)[\/\s]+([\w\.]+)/i],[[q,"Opera Mini"],K],[/\s(opr)\/([\w\.]+)/i],[[q,"Opera"],K],[/(?:ms|\()(ie)\s([\w\.]+)/i],[q,K],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[q,"IE"],K],[/(edge|edgios|edga)\/((\d+)?[\w\.]+)/i],[[q,"Edge"],K],[/(opt)\/([\w\.]+)/i],[[q,"Opera Touch"],K],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[q,"UCBrowser"],K],[/(micromessenger)\/([\w\.]+)/i],[[q,"WeChat"],K],[/(qqbrowserlite)\/([\w\.]+)/i],[q,K],[/(QQ)\/([\d\.]+)/i],[q,K],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[q,K],[/(MetaSr)[\/\s]?([\w\.]+)/i],[q],[/(LBBROWSER)/i],[q],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[K,[q,"MIUI Browser"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[K,[q,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[q,/(.+)/,"$1 WebView"],K],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[q,/(.+(?:g|us))(.+)/,"$1 $2"],K],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[K,[q,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[q,K],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[q,"Chrome"],K],[/fxios\/([\w\.-]+)/i],[K,[q,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[K,[q,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[K,q],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[q,[K,X.str,z.browser.oldsafari.version]],[/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i],[q,K]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[F,G,[$,"tablet"]],[/applecoremedia\/[\w\.]+ \((ipad)/],[F,[G,"Apple"],[$,"tablet"]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[F,G,[$,B]],[/\((ip[honed|\s\w*]+);/i],[F,[G,"Apple"],[$,B]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[G,"Sony"],[F,"Xperia Tablet"],[$,"tablet"]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[F,[G,"Sony"],[$,B]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[F,[G,"Huawei"],[$,B]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[F,[G,"Motorola"],[$,"tablet"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[G,"Samsung"],F,[$,"tablet"]],[/smart-tv.+(samsung)/i],[G,[$,"smarttv"],F],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[G,"Samsung"],F,[$,B]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[G,"Nokia"],F,[$,B]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[F,[G,"Lenovo"],[$,"tablet"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[G,F,[$,B]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[F,/_/g," "],[G,"Xiaomi"],[$,B]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[F,/_/g," "],[G,"Xiaomi"],[$,"tablet"]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[F,[G,"Meizu"],[$,"tablet"]],[/(mz)-([\w-]{2,})/i],[[G,"Meizu"],F,[$,B]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[G,"Voice"],F,[$,B]]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[q,K],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[q,[K,X.str,z.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[q,"Windows"],[K,X.str,z.os.windows.version]],[/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]*)/i],[q,K],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[K,/_/g,"."],[q,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[q,"Mac OS"],[K,/_/g,"."]]]},J=function e(t,n){if("object"===(void 0===t?"undefined":_(t))&&(n=t,t=void 0),!(this instanceof e))return new e(t,n).getResult();var i=t||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""),r=n?V(H,n):H;return this.getBrowser=function(){var e={name:void 0,version:void 0};return X.rgx.call(e,i,r.browser),e.major=W(e.version),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return X.rgx.call(e,i,r.device),e},this.getOS=function(){var e={name:void 0,version:void 0};return X.rgx.call(e,i,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),os:this.getOS(),device:this.getDevice()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};function Y(){var e=J(g),t=D(),n=window.performance.navigation.type,i={url:window.location.origin+window.location.pathname,fullPath:window.location.href,browser:e.browser.name||"",browser_ver:e.browser.version||"",os:e.os.name,os_ver:e.os.version,model:e.device.model,net:L(),load_type:p[n],_log_type:"performance",_uuid:"",_uniq_id:j(),app:D(),app_ver:R(t),webview_type:M()};return"Kaola"===i.app&&(i.browser=i.app,i.browser_ver=i.app_ver),new S(function(e){I.invoke("getURSInfo").then(function(t){var n,r;"[object Object]"===Object.prototype.toString.call(t)?i._uuid=t.ursAuth||t.ursId||t.ursToken||"":-1===t&&(i._uuid=(r=new RegExp("(^| )"+"_ntes_nuid"+"=([^;]*)(;|$)"),(n=document.cookie.match(r))?unescape(n[2]):null)),e(i)}).catch(function(){e(i)})})}var Q=window.performance,Z=Q&&Q.timing.navigationStart,ee=["SCRIPT","STYLE","META","HEAD","LINK"],te={SVG:1,IMG:1,CANVAS:1,VIDEO:1},ne=window.innerWidth,ie=window.innerHeight,re=function(){function e(){E(this,e),this.statusCollector=[],this.flag=!0,this.muo=MutationObserver,this.observer=null,this.callbackCount=1,this.mp={},this.muo&&Q&&Z&&this.initObserver()}return k(e,[{key:"initObserver",value:function(){var e=this;this.observer=new MutationObserver(function(){var t=Q.now&&Q.now()||Date.now()-Z,n=document.body;n&&(e.doTag(n,e.callbackCount++),e.statusCollector.push({t:t}))}),this.observer.observe(document,{childList:!0,subtree:!0})}},{key:"getFMP",value:function(){var e=this;return new S(function(t,n){"complete"===document.readyState?e.checkCanCal(Z)?setTimeout(function(){t(e.calFinallScore())},500):t(e.calFinallScore()):window.addEventListener("load",function(){e.getFMP()},!0)})}},{key:"initResourceMap",value:function(){var e=this;Q.getEntries().forEach(function(t){e.mp[t.name]=t.responseEnd})}},{key:"doTag",value:function(e,t){var n=e.tagName;if(-1===ee.indexOf(n)){var i=e.children?e.children.length:0;if(i>0)for(var r=e.children,o=i-1;o>=0;o--)null===r[o].getAttribute("_ti")&&r[o].setAttribute("_ti",t),this.doTag(r[o],t)}}},{key:"calFinallScore",value:function(){var e=-1;if(Q&&Q.getEntries&&MutationObserver&&this.flag){this.observer.disconnect(),this.flag=!1;var t=this.deepTraversal(document.body),n=void 0;if(t.dpss.forEach(function(e){n&&n.st?n.st<e.st&&(n=e):n=e}),n&&n.els){this.initResourceMap();var i=this.filterTheResultSet(n.els);e=this.calResult(i)}}return e}},{key:"calResult",value:function(e){var t=this,n=-1;return e.forEach(function(e){var i=0;if(1===e.weight){var r=+e.node.getAttribute("_ti")-1;i=t.statusCollector[r].t}else if(2===e.weight)if("IMG"===e.node.tagName)i=t.mp[e.node.src];else if("SVG"===e.node.tagName){var o=+e.node.getAttribute("_ti")-1;i=t.statusCollector[o].t}else{var a=e.node.style.backgroundImage.match(/url\(\"(.*?)\"\)/),s=void 0;a&&a[1]&&(s=a[1]),-1==s.indexOf("http")&&(s=location.protocol+a[1]),i=t.mp[s]}else if(4===e.weight)if("CANVAS"===e.node.tagName){var c=+e.node.getAttribute("_ti")-1;i=t.statusCollector[c].t}else"VIDEO"===e.node.tagName&&!(i=t.mp[e.node.src])&&(i=t.mp[e.node.poster]);n<i&&(n=i)}),n}},{key:"filterTheResultSet",value:function(e){var t=0;e.forEach(function(e){t+=e.st});var n=t/e.length;return e.filter(function(e){return e.st>n})}},{key:"deepTraversal",value:function(e){if(e){for(var t,n=[],i=0;t=e.children[i];i++){var r=this.deepTraversal(t);r.st&&n.push(r)}return this.calScore(e,n)}return{}}},{key:"calScore",value:function(e,t){var n=e.getBoundingClientRect(),i=n.width,r=n.height,o=n.left,a=n.top,s=(n.bottom,n.right,1);(ie<a||ne<o)&&(s=0);var c=0;t.forEach(function(e){c+=e.st});var u=te[e.tagName]||1;1===u&&e.style.backgroundImage&&"initial"!==e.style.backgroundImage&&(u=te.IMG);var l=i*r*u*s,d=[{node:e,st:l,weight:u}],f=this.calAreaPercent(e);return(c>l*f||0===f)&&(l=c,d=[],t.forEach(function(e){d=d.concat(e.els)})),{dpss:t,st:l,els:d}}},{key:"checkCanCal",value:function(e){var t=Date.now()-e;return!(t>1e3||t-(this.statusCollector&&this.statusCollector.length&&this.statusCollector[this.statusCollector.length-1].t||0)>1e3)}},{key:"calAreaPercent",value:function(e){var t=e.getBoundingClientRect(),n=t.left,i=t.right,r=t.top,o=t.bottom,a=t.width,s=t.height,c=ne,u=ie,l=i-n+(c-0)-(Math.max(i,c)-Math.min(n,0));if(l<=0)return 0;var d=o-r+(u-0)-(Math.max(o,u)-Math.min(r,0));return d<=0?0:l*d/(a*s)}}]),e}(),oe=window.performance,ae=function(){var e={},t=void 0;return oe&&"Function"===s(oe.getEntriesByType)&&(oe.getEntriesByType("paint")||[]).map(function(n){if(a(t=r(n.startTime,1)))switch(n.name){case"first-paint":e.FP=t;break;case"first-contentful-paint":e.FCP=t}}),e},se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={},n=void 0,i=void 0;if(oe&&"Function"===s(oe.getEntriesByType))for(var o in n=oe.getEntriesByType("navigation")[0]||{},e)a(i=n[e[o]])&&(t[o]=r(i,1));return t},ce={rs:["fetchStart","navigationStart"],rdc:["redirectEnd","redirectStart"],dns:["domainLookupEnd","domainLookupStart"],tcp:["connectEnd","connectStart"],ssl:["connectEnd","secureConnectionStart"],ttfb:["responseStart","requestStart"],trans:["responseEnd","responseStart"],dom:["domInteractive","responseEnd"],res:["loadEventStart","domContentLoadedEventEnd"]},ue={FBT:["responseStart","domainLookupStart"],FPT:["responseEnd","fetchStart"],TTI:["domInteractive","fetchStart"],DCL:["domContentLoadedEventEnd","fetchStart"],L:["loadEventStart","fetchStart"]},le={DCL:"domContentLoadedEventStart",L:"loadEventStart"},de=new re;window._resourceCollection=[];var fe;fe=function(){setTimeout(function(){try{e=window.performance?window.performance.timing:null,t=window.performance?window.performance.getEntries:null,n={},Y().then(function(i){if(w.$setIndexs(i),e){var u=c({},ce,ue);for(var l in u){var d=u[l],f=o(e[d[0]],e[d[1]]);a(f)&&(n[l]=f)}c(n,ae(),se(le)),w.$report({category:"kl_front_perf",indexs:c({},i,{_log_type:"performance"}),metrics:n,time:Date.now()}),de.getFMP().then(function(e){a(e)&&w.$push({category:"kl_front_perf_fmp",indexs:{_log_type:"performance"},metrics:{FMP:r(e,1)},time:Date.now()})})}if("Function"===s(t)){var v=[],h=t();for(var p in h){var m=h[p],g=m.initiatorType;"link"!==g&&"script"!==g||v.push(m)}var b=function(e,t){function n(e,t){for(var n=[],i=0;i<e.length;i++)-1===t.indexOf(e[i])&&n.push(e[i]);return n}return n(e,t).concat(n(t,e))}(v,window._resourceCollection);for(var y in b){var _=v[y],E={rsize:r(_.transferSize,1),rduration:r(_.duration,1),rrdct:o(_.redirectEnd,_.redirectStart,1),rdns:o(_.domainLookupEnd,_.domainLookupStart,1),rreq:o(_.responseEnd,_.requestStart,1),rtcp:o(_.connectEnd,_.connectStart,1)};for(var k in E)a(E[k])||delete E[k];w.$push({category:"kl_front_resperf",indexs:{name:_.name.match(/^[^?#]*/)[0],dataType:_.entryType+"/"+_.initiatorType,_log_type:"resource"},metrics:E,time:Date.now()})}window._resourceCollection=v}})}catch(e){}var e,t,n},50)},function(e,t,n,i){if(e.addEventListener)return e.addEventListener(t,n,i),!0;if(e.attachEvent)return e.attachEvent("on"+t,n);var r=e["on"+t];e["on"+t]=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];r.apply(this,t),n.apply(this,t)}}(window,"load",fe,!1)}();
